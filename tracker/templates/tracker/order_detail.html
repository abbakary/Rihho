{% extends 'tracker/base.html' %}
{% load static %}

{% block title %}Order Details{% endblock %}

{% block content %}
  <div class="container-fluid">
    <div class="page-title">
      <div class="row">
        <div class="col-6"><h4>Order {{ order.order_number }}</h4></div>
        <div class="col-6">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'tracker:orders_list' %}">Orders</a></li>
            <li class="breadcrumb-item active">Details</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row g-3">
      <div class="col-xl-8">
        <div class="card"><div class="card-header"><h5 class="mb-0">Order Info</h5></div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6"><div class="f-light">Type</div><div class="f-w-600 text-capitalize">{{ order.type }}</div></div>
              <div class="col-md-6"><div class="f-light">Status</div><div class="f-w-600 text-capitalize">{{ order.status }}</div></div>
              <div class="col-md-6"><div class="f-light">Priority</div><div class="f-w-600 text-capitalize">{{ order.priority }}</div></div>
              <div class="col-md-6"><div class="f-light">Created</div><div class="f-w-600">{{ order.created_at|date:'Y-m-d H:i' }}</div></div>
              {% if order.started_at %}<div class="col-md-6"><div class="f-light">Started</div><div class="f-w-600">{{ order.started_at|date:'Y-m-d H:i' }}</div></div>{% endif %}
              {% if order.completed_at %}<div class="col-md-6"><div class="f-light">Completed</div><div class="f-w-600">{{ order.completed_at|date:'Y-m-d H:i' }}</div></div>{% endif %}
            </div>
            <hr>
            {% if order.type == 'service' %}
              <div class="mb-2 f-w-600">Service Description</div>
              <div>{{ order.description|default:'-' }}</div>
              <div class="mt-2 f-light">Estimated duration</div>
              <div class="f-w-600">{{ order.estimated_duration|default:'-' }} min</div>
            {% elif order.type == 'sales' %}
              <div class="row g-3">
                <div class="col-md-6"><div class="f-light">Item</div><div class="f-w-600">{{ order.item_name }}</div></div>
                <div class="col-md-6"><div class="f-light">Brand</div><div class="f-w-600">{{ order.brand }}</div></div>
                <div class="col-md-6"><div class="f-light">Quantity</div><div class="f-w-600">{{ order.quantity }}</div></div>
                <div class="col-md-6"><div class="f-light">Tire Type</div><div class="f-w-600">{{ order.tire_type|default:'-' }}</div></div>
              </div>
            {% else %}
              <div class="row g-3">
                <div class="col-md-6"><div class="f-light">Inquiry Type</div><div class="f-w-600">{{ order.inquiry_type|default:'General' }}</div></div>
                <div class="col-md-6"><div class="f-light">Contact</div><div class="f-w-600 text-capitalize">{{ order.contact_preference|default:'phone' }}</div></div>
                <div class="col-12"><div class="f-light">Questions</div><div>{{ order.questions|linebreaksbr }}</div></div>
                {% if order.follow_up_date %}<div class="col-md-6"><div class="f-light">Follow up</div><div class="f-w-600">{{ order.follow_up_date }}</div></div>{% endif %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col-xl-4">
        <div class="card"><div class="card-header"><h5 class="mb-0">Customer</h5></div>
          <div class="card-body">
            <div class="mb-2 f-w-600"><a href="{% url 'tracker:customer_detail' order.customer.id %}">{{ order.customer.full_name }}</a></div>
            <div class="f-light">Phone</div><div class="mb-2">{{ order.customer.phone }}</div>
            <div class="f-light">Email</div><div class="mb-2">{{ order.customer.email|default:'-' }}</div>
          </div>
        </div>
        <div class="card"><div class="card-header"><h5 class="mb-0">Vehicle</h5></div>
          <div class="card-body">
            {% if order.vehicle %}
              <div class="mb-1">{{ order.vehicle.plate_number }}</div>
              <div class="mb-1">{{ order.vehicle.make }} {{ order.vehicle.model }}</div>
              <div class="mb-1 text-capitalize">{{ order.vehicle.vehicle_type }}</div>
            {% else %}
              <div>-</div>
            {% endif %}
          </div>
        </div>
        <div class="card"><div class="card-header"><h5 class="mb-0">Update Status</h5></div>
          <div class="card-body">
            <form method="post" action="{% url 'tracker:update_order_status' order.id %}">
              {% csrf_token %}
              <div class="input-group">
                <select name="status" class="form-select">
                  {% for k,v in order.STATUS_CHOICES %}
                    <option value="{{ k }}" {% if order.status == k %}selected{% endif %}>{{ v }}</option>
                  {% endfor %}
                </select>
                <button class="btn btn-primary" type="submit">Update</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
